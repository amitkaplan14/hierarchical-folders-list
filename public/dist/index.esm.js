import e,{useRef as n,useState as t,useCallback as r,useEffect as i,useMemo as o}from"react";import l from"@emotion/styled";import a from"classnames";var d=function(){return d=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e},d.apply(this,arguments)};function c(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e}"function"==typeof SuppressedError&&SuppressedError;var s,u,p,f,h,v,g,m=function(e,n,t){return void 0===n&&(n=0),e.reduce((function(e,r){var i=Boolean(r.isFolder||r.children&&r.children.length>0),o={id:r.id,name:r.name,isFolder:i,depth:n,parentId:t,data:r};return e.push(o),i&&r.children&&r.children.length>0&&e.push.apply(e,m(r.children,n+1,r.id)),e}),[])},x=function(e,n){for(var t=[],r=new Set([void 0]),i=0,o=e;i<o.length;i++){var l=o[i];r.has(l.parentId)&&(t.push(l),l.isFolder&&n.has(l.id)&&r.add(l.id))}return t},w=function(e,n,t){var r=n.findIndex((function(n){return n.id===e}));return-1===r?null:n["down"===t?Math.min(r+1,n.length-1):Math.max(r-1,0)].id},b=function(e){var o=e.items,l=e.itemHeight,a=e.overscan,c=void 0===a?5:a,s=e.enabled,u=void 0===s||s,p=n(null),f=t({start:0,end:20}),h=f[0],v=f[1];o.length;var g=r((function(){if(p.current&&u){var e=p.current,n=e.scrollTop,t=e.clientHeight,r=Math.max(0,Math.floor(n/l)-c),i=Math.min(o.length-1,Math.ceil((n+t)/l)+c);v({start:r,end:i})}}),[l,o.length,c,u]),m=r((function(e){if(p.current&&u){var n=e*l;p.current.scrollTop=n}}),[l,u]),x=r((function(e){if(p.current&&u){var n=p.current,t=e*l,r=t+l,i=n.scrollTop,o=i+n.clientHeight;t<i?n.scrollTop=t:r>o&&(n.scrollTop=r-n.clientHeight)}}),[l,u]);i((function(){if(u){var e=p.current;if(e){var n=function(){g()};return e.addEventListener("scroll",n),function(){e.removeEventListener("scroll",n)}}}}),[g,u]),i((function(){if(u){var e=function(){g()};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}}),[g,u]),i((function(){g()}),[g,o]);return{visibleItems:(u?o.slice(h.start,h.end+1):o).map((function(e){var n=o.findIndex((function(n){return n.id===e.id}));return d(d({},e),{style:{position:"absolute",top:"".concat(n*l,"px"),left:0,width:"100%",height:"".concat(l,"px")}})})),containerStyle:u?{position:"relative",height:"100%",overflow:"auto"}:{},containerRef:p,scrollToIndex:m,scrollItemIntoView:x}},I=function(e){var n=e.enabled,t=void 0===n||n,o=e.expandOnEnter,l=void 0===o||o,a=e.collapseOnEscape,d=void 0===a||a,c=e.navigateWithArrows,s=void 0===c||c,u=e.visibleItems,p=e.selectedId,f=e.expandedIds,h=e.setSelectedId,v=e.toggleExpand;e.scrollToIndex;var g=e.scrollItemIntoView,m=r((function(e){if(t&&p){var n=u.find((function(e){return e.id===p}));if(n)switch(u.findIndex((function(e){return e.id===p})),e.key){case"ArrowDown":if(!s)return;e.preventDefault();var r=w(p,u,"down");if(r){h(r);var i=u.findIndex((function(e){return e.id===r}));g(i)}break;case"ArrowUp":if(!s)return;e.preventDefault();var o=w(p,u,"up");if(o){h(o);var a=u.findIndex((function(e){return e.id===o}));g(a)}break;case"ArrowRight":if(!s)return;e.preventDefault(),n.isFolder&&!f.has(p)&&v(p);break;case"ArrowLeft":if(!s)return;if(e.preventDefault(),n.isFolder&&f.has(p))v(p);else if(n.parentId){var c=u.find((function(e){return e.id===n.parentId}));if(c){h(c.id);var m=u.findIndex((function(e){return e.id===c.id}));g(m)}}break;case"Enter":if(!l)return;e.preventDefault(),n.isFolder&&v(p);break;case"Escape":if(!d)return;if(e.preventDefault(),n.isFolder&&f.has(p))v(p);else if(n.parentId){var x=u.find((function(e){return e.id===n.parentId}));if(x){h(x.id);m=u.findIndex((function(e){return e.id===x.id}));g(m)}}}}}),[t,p,u,f,s,l,d,h,v,g]);i((function(){if(t)return window.addEventListener("keydown",m),function(){window.removeEventListener("keydown",m)}}),[t,m])},E=l.div(s||(s=c(["\n  display: flex;\n  align-items: center;\n  padding-left: ","px;\n  height: ","px;\n  cursor: pointer;\n  user-select: none;\n  background-color: ",";\n  border-left: ",";\n  \n  &:hover {\n    background-color: ",";\n  }\n"],["\n  display: flex;\n  align-items: center;\n  padding-left: ","px;\n  height: ","px;\n  cursor: pointer;\n  user-select: none;\n  background-color: ",";\n  border-left: ",";\n  \n  &:hover {\n    background-color: ",";\n  }\n"])),(function(e){return 20*e.depth+4}),(function(e){return e.height}),(function(e){return e.isSelected?"rgba(0, 120, 215, 0.1)":"transparent"}),(function(e){return e.isSelected?"2px solid #0078d7":"2px solid transparent"}),(function(e){return e.isSelected?"rgba(0, 120, 215, 0.2)":"rgba(0, 0, 0, 0.05)"})),y=l.div(u||(u=c(["\n  display: flex;\n  align-items: center;\n  margin-right: 6px;\n  width: 20px;\n  height: 20px;\n  \n  svg {\n    width: 16px;\n    height: 16px;\n  }\n"],["\n  display: flex;\n  align-items: center;\n  margin-right: 6px;\n  width: 20px;\n  height: 20px;\n  \n  svg {\n    width: 16px;\n    height: 16px;\n  }\n"]))),k=l.div(p||(p=c(["\n  width: 16px;\n  height: 16px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 4px;\n  transform: rotate(",");\n  transition: transform 0.1s ease;\n  \n  &::before {\n    content: '';\n    display: block;\n    width: 0;\n    height: 0;\n    border-style: solid;\n    border-width: 4px 0 4px 6px;\n    border-color: transparent transparent transparent #555;\n  }\n"],["\n  width: 16px;\n  height: 16px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 4px;\n  transform: rotate(",");\n  transition: transform 0.1s ease;\n  \n  &::before {\n    content: '';\n    display: block;\n    width: 0;\n    height: 0;\n    border-style: solid;\n    border-width: 4px 0 4px 6px;\n    border-color: transparent transparent transparent #555;\n  }\n"])),(function(e){return e.isExpanded?"90deg":"0deg"})),S=l.div(f||(f=c(["\n  width: 16px;\n  height: 16px;\n  margin-right: 4px;\n"],["\n  width: 16px;\n  height: 16px;\n  margin-right: 4px;\n"]))),C=l.div(h||(h=c(["\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  flex-grow: 1;\n"],["\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  flex-grow: 1;\n"]))),H=function(){return e.createElement("svg",{viewBox:"0 0 24 24",fill:"#ffc107",xmlns:"http://www.w3.org/2000/svg"},e.createElement("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"}))},M=function(){return e.createElement("svg",{viewBox:"0 0 24 24",fill:"#90caf9",xmlns:"http://www.w3.org/2000/svg"},e.createElement("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"}))},O=function(n){var t=n.item,i=n.depth,o=n.isExpanded,l=n.isSelected,a=n.toggleExpand,d=n.onItemClick,c=n.onItemDoubleClick,s=n.onItemContextMenu,u=n.renderItemContent,p=n.renderItemIcon,f=n.itemHeight,h=r((function(e){e.stopPropagation(),d(t)}),[d,t]),v=r((function(e){e.stopPropagation(),c&&c(t),(t.isFolder||t.children&&t.children.length>0)&&a(t.id)}),[c,a,t]),g=r((function(e){e.preventDefault(),e.stopPropagation(),s&&s(t,e)}),[s,t]),m=r((function(e){e.stopPropagation(),a(t.id)}),[a,t.id]),x=Boolean(t.isFolder||t.children&&t.children.length>0),w=r((function(){return p?p(t,o):x?e.createElement(H,null):e.createElement(M,null)}),[t,x,o,p]),b=u?u(t,o):e.createElement(C,null,t.name);return e.createElement(E,{depth:i,isSelected:l,isFolder:x,height:f,onClick:h,onDoubleClick:v,onContextMenu:g,"data-item-id":t.id},x?e.createElement(k,{isExpanded:o,onClick:m}):e.createElement(S,null),e.createElement(y,null,t.icon||w()),b)},z=l.div(v||(v=c(["\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n  font-size: 14px;\n  border: 1px solid #e0e0e0;\n  border-radius: 4px;\n  background-color: #fff;\n  box-sizing: border-box;\n  outline: none;\n"],["\n  width: 100%;\n  height: 100%;\n  overflow: auto;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;\n  font-size: 14px;\n  border: 1px solid #e0e0e0;\n  border-radius: 4px;\n  background-color: #fff;\n  box-sizing: border-box;\n  outline: none;\n"]))),D=l.div(g||(g=c(["\n  position: relative;\n  width: 100%;\n  height: 100%;\n"],["\n  position: relative;\n  width: 100%;\n  height: 100%;\n"]))),F=function(l){var d=l.data,c=l.onItemClick,s=l.onItemDoubleClick,u=l.onItemContextMenu,p=l.renderItemContent,f=l.renderItemIcon,h=l.itemHeight,v=void 0===h?28:h,g=l.className,w=l.style,E=l.defaultExpandedIds,y=void 0===E?[]:E,k=l.keyboard,S=void 0===k?{enabled:!0,expandOnEnter:!0,collapseOnEscape:!0,navigateWithArrows:!0}:k,C=l.virtualizationOptions,H=void 0===C?{enabled:!0,overscan:10}:C,M=t(new Set(y)),F=M[0],A=M[1],L=t(null),T=L[0],P=L[1],V=n(null),j=o((function(){return m(d)}),[d]),B=o((function(){return x(j,F)}),[j,F]),R=b({items:B,itemHeight:v,overscan:null==H?void 0:H.overscan,enabled:null==H?void 0:H.enabled}),W=R.visibleItems,U=R.containerStyle,N=R.containerRef,q=R.scrollToIndex,G=R.scrollItemIntoView,J=r((function(e){P(e.id),c&&c(e)}),[c]),K=r((function(e){A((function(n){var t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t}))}),[]);I({enabled:null==S?void 0:S.enabled,expandOnEnter:null==S?void 0:S.expandOnEnter,collapseOnEscape:null==S?void 0:S.collapseOnEscape,navigateWithArrows:null==S?void 0:S.navigateWithArrows,visibleItems:B,selectedId:T,expandedIds:F,setSelectedId:P,toggleExpand:K,scrollToIndex:q,scrollItemIntoView:G}),i((function(){V.current&&(null==S?void 0:S.enabled)&&V.current.focus()}),[null==S?void 0:S.enabled]);var Q=r((function(e){N.current=e,V.current!==e&&(V.current=e)}),[N]);return e.createElement(z,{ref:V,className:a("hierarchical-folder-list",g),style:w,tabIndex:0},e.createElement(D,{ref:Q,style:U},e.createElement("div",{style:{height:"".concat(B.length*v,"px"),position:"relative"}},W.map((function(n){var t=n,r=F.has(t.id),i=T===t.id,o=t.depth;return e.createElement("div",{key:t.id,style:n.style},e.createElement(O,{item:t.data,depth:o,isExpanded:r,isSelected:i,toggleExpand:K,onItemClick:J,onItemDoubleClick:s,onItemContextMenu:u,renderItemContent:p,renderItemIcon:f,itemHeight:v}))})))))};export{O as FolderItem,F as FolderList,m as flattenTree,x as getVisibleItems,I as useKeyboardNavigation,b as useVirtualization};
//# sourceMappingURL=index.esm.js.map
